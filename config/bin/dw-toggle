#!/usr/bin/env bash
set -euo pipefail

addr="$(hyprctl -j activewindow | jq -r '.address // empty')"
[ -n "$addr" ] || exit 0

state_dir="${XDG_CACHE_HOME:-$HOME/.cache}/dw-state"
mkdir -p "$state_dir"
state_file="$state_dir/${addr}.state"

# État "on" par défaut si le fichier n'existe pas
cur="on"
[ -f "$state_file" ] && cur="$(cat "$state_file" 2>/dev/null || echo on)"

if [ "$cur" = "on" ]; then
  hyprctl dispatch darkwindow:shade "address:$addr" dw_off >/dev/null 2>&1 || true
  echo "off" > "$state_file"
else
  hyprctl dispatch darkwindow:shade "address:$addr" glass_all >/dev/null 2>&1 || true
  echo "on" > "$state_file"
fi
